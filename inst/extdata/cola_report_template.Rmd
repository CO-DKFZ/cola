Cola report
==================

**Date**: `r Sys.Date()`

----------------------------------------------------------------

<style type='text/css'>
[% paste(readLines("~/project/development/cola/inst/extdata/custom.css"), collapse = "\n") %]
</style>

```{r, echo = FALSE, message = FALSE}
library(markdown)
options(markdown.HTML.options = setdiff(c(getOption("markdown.HTML.options"), "toc"), "base64_images"))
options(width = 140)
opts_chunk$set(comment = "#>")
```

## Summary

All available functions which can be applied to `res_list` object.

```{r}
[% if(var_name != "res_list") paste("res_list =", var_name) %]
res_list
```

Global distribution for each sample:

```{r, echo = FALSE}
library(ComplexHeatmap)
densityHeatmap(res_list@.env$data, anno = HeatmapAnnotation(df = res_list@list[[1]]@known_anno, col = res_list@list[[1]]@known_col),
	ylab = "value")
```

Best `k` (number of partitions) for each combination of top methods and partition methods.

```{r, eval = FALSE}
get_best_k(res_list)
```

```{r, echo = FALSE}
tb = get_best_k(res_list)
rntb = rownames(tb)
l = tb$PAC < 0.05 & tb$mean_silhouette > 0.95
rownames(tb) = ifelse(l, qq("[@{rntb}](?@{rntb})", collapse = FALSE), rntb)
tb = cbind(tb, ifelse(l, ifelse(tb$PAC < 0.01, "**", "*"), ""))
colnames(tb)[ncol(tb)] = ""
kable(tb)
```


CDF of consensus matrix for all methods:

```{r, fig.width = 14, fig.height = 14*length(res_list@top_method)/length(res_list@partition_method)}
collect_plots(res_list, fun = plot_ecdf)
```

Consensus heatmaps for all methods:

```{r, results = "asis", echo = FALSE, include = TRUE}
[% k = res_list@list[[1]]@k
ratio = length(res_list@top_method)/length(res_list@partition_method)
qq("knitr_add_tab_item('collect_plots(res_list, k = @<k>, fun = consensus_heatmap)', 'k = @<k>', opt = 'fig.width = 14, fig.height = 14*@<ratio>')\n", code.pattern = "@<CODE>") %]
knitr_insert_tabs()
```

Membership heatmaps for all methods:

```{r, results = "asis", echo = FALSE, include = TRUE}
[% k = res_list@list[[1]]@k
ratio = length(res_list@top_method)/length(res_list@partition_method)
qq("knitr_add_tab_item('collect_plots(res_list, k = @<k>, fun = membership_heatmap)', 'k = @<k>', opt = 'fig.width = 14, fig.height = 14*@<ratio>')\n", code.pattern = "@<CODE>") %]
knitr_insert_tabs()
```

Signature heatmaps for all methods:

```{r, results = "asis", echo = FALSE, include = TRUE}
[% k = res_list@list[[1]]@k
ratio = length(res_list@top_method)/length(res_list@partition_method)
qq("knitr_add_tab_item('collect_plots(res_list, k = @<k>, fun = get_signatures)', 'k = @<k>', opt = 'fig.width = 14, fig.height = 14*@<ratio>')\n", code.pattern = "@<CODE>") %]
knitr_insert_tabs()
```

Get statistics for all methods:

```{r, results = "asis", echo = FALSE, include = TRUE}
[% k = res_list@list[[1]]@k
qq("knitr_add_tab_item('get_stat(res_list, k = @<k>)', 'k = @<k>')\n", code.pattern = "@<CODE>") %]
knitr_insert_tabs()
```

Collect partitions from all methods:

```{r, results = "asis", echo = FALSE, include = TRUE}
[% k = res_list@list[[1]]@k
qq("knitr_add_tab_item('collect_classes(res_list, k = @<k>)', 'k = @<k>', opt = 'fig.width = 14, fig.height = 8')\n", code.pattern = "@<CODE>") %]
knitr_insert_tabs()
```

Overlap of top rows in different top methods:

```{r, results = "asis", echo = FALSE, include = TRUE}
[% top_n = res_list@list[[1]]@top_n
qq("knitr_add_tab_item('top_rows_overlap(res_list, top_n = @<top_n>)', 'top_n = @<top_n>')\n", code.pattern = "@<CODE>") %]
knitr_insert_tabs()
```

Also visualize the correspondance of rankings between different top methods:

```{r, fig.width = 14, fig.height = 8}
top_rows_overlap(res_list, top_n = [% min(res_list@list[[1]]@top_n) %], type = "correspondance")
```

Heatmaps for the top rows:

```{r, results = "asis", echo = FALSE, include = TRUE}
[% top_n = res_list@list[[1]]@top_n
qq("knitr_add_tab_item('top_rows_heatmap(res_list, top_n = @<top_n>)', 'top_n = @<top_n>', opt = 'fig.width = 14, fig.height = 14/@<length(res_list@list[[1]]@top_n)>')\n", code.pattern = "@<CODE>") %]
knitr_insert_tabs()
```

[% 
section_template = paste(readLines("~/project/development/cola/inst/extdata/section_template.Rmd"), collapse = "\n")
section = NULL
for(top_method in res_list@top_method) {
    for(partition_method in res_list@partition_method) {
        section = c(section, qq(section_template))
    }
}
section = c(section, "\n")
paste(section, collapse = "\n\n") %]


## Session info

```{r}
sessionInfo()
```

Cola report for hierarchical partitioning
==================

**Date**: `r Sys.Date()`

----------------------------------------------------------------

<style type='text/css'>
[% paste(readLines("~/project/development/cola/inst/extdata/custom.css"), collapse = "\n") %]
</style>

```{r, echo = FALSE, message = FALSE}
library(markdown)
options(markdown.HTML.options = setdiff(c(getOption("markdown.HTML.options"), "toc"), "base64_images"))
options(width = 100)
opts_chunk$set(comment = "#>")
opts_chunk$set(fig.path = "figure_hc/")
```

## Summary

All available functions which can be applied to `res` object.

```{r}
[% if(var_name != "res_hc") {expr = paste("res_hc =", var_name); eval(parse(text =expr)); expr} %]
res_hc
```

Dimension of the input matrix:

```{r}
dim(res_hc@list[["0"]]@.env$data)
```

Global distribution for each sample:

```{r}
library(ComplexHeatmap)
densityHeatmap(res_hc@list[["0"]]@.env$data, anno = HeatmapAnnotation(df = res_hc@list[["0"]]@known_anno, 
	col = res_hc@list[["0"]]@known_col), ylab = "value")
```

About the hierarchy:


```{r}
max_depth = max_depth(res_hc)
max_depth
all_nodes = all_nodes(res_hc)
all_nodes
all_leaves = all_leaves(res_hc)
all_leaves
```


Partitions for different depth:

```{r, results = "asis", echo = FALSE, include = TRUE}
[% max_depth = max_depth(res_hc);
depth = 2:max_depth
qq("knitr_add_tab_item('collect_classes(res_hc, depth = @<depth>)\nget_class(res_hc, depth = @<depth>)', 'depth = @<depth>')\n", code.pattern = "@<CODE>") %]
knitr_insert_tabs()
```

MDS plot:

```{r}
dimension_reduction(res_hc, merge = TRUE)
```

Or MDS plot at each node

[% 
n_plots = length(setdiff(all_nodes(res_hc), all_leaves(res_hc)))
nc = min(c(4, n_plots))
nr = ceiling(n_plots/nc)
""
 %]
```{r, fig.width = [% nc*14/3 %], fig.height = [% nr*14/3 %], echo = 2}
par(mfrow = c(nr, nc))
dimension_reduction(res_hc, merge = FALSE)
par(mfrow = c(1, 1))
```

Signature genes and the overlap:

```{r, echo = max_depth > 2, eval = max_depth > 2}
lt_sig = get_signatures(res_hc)
venn_euler(lt_sig)
```


[% if(!is.null(res_hc@list[['0']]@known_anno)) {
	max_depth = max_depth(res_hc);
	depth = 2:max_depth
	txt = "Test correlation between subgroups and known annotations:\n\n"
	txt = c(txt, "```{r, results = 'asis', echo = FALSE, include = TRUE}\n")
	txt = c(txt, qq("knitr_add_tab_item('test_to_known_factors(res_hc, depth = @<depth>)', 'depth = @<depth>')\n", code.pattern = '@<CODE>'))
	txt = c(txt, "knitr_insert_tabs()\n")
	txt = c(txt, "```\n")
	paste(txt, collapse = "\n")
} else {
	""
} %]

## Results for each node

[%
section_template = paste(readLines("~/project/development/cola/inst/extdata/section_hc_node_template.Rmd"), collapse = "\n")
section = NULL
for(node in setdiff(all_nodes(res_hc), all_leaves(res_hc))) {
    section = c(section, qq(section_template))
}
section = c(section, "\n")
paste(section, collapse = "\n\n")
%]

## Session info

```{r}
sessionInfo()
```

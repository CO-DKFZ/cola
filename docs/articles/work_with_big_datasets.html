<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Work with Big Datasets • cola</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Work with Big Datasets">
<meta property="og:description" content="cola">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cola</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/cola.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cola_quick.html">A Quick Start of cola Package</a>
    </li>
    <li>
      <a href="../articles/functional_enrichment.html">Automatic Functional Enrichment on Signature Genes</a>
    </li>
    <li>
      <a href="../articles/predict.html">Predict Classes for New Samples</a>
    </li>
    <li>
      <a href="../articles/work_with_big_datasets.html">Work with Big Datasets</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/cola/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="work_with_big_datasets_files/header-attrs-2.3/header-attrs.js"></script><script src="work_with_big_datasets_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Work with Big Datasets</h1>
                        <h4 class="author">Zuguang Gu ( <a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a> )</h4>
            
            <h4 class="date">2020-08-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/cola/blob/master/vignettes/work_with_big_datasets.Rmd"><code>vignettes/work_with_big_datasets.Rmd</code></a></small>
      <div class="hidden name"><code>work_with_big_datasets.Rmd</code></div>

    </div>

    
    
<p>cola can be idealy applied to datasets with intermediate number of samples (around 500), however, the running time and the memory usage might not be acceptable if the number of samples gets very huge, e.g., more than thousands. Nevertheless, we can propose the following two strategies to partially solve this problem.</p>
<ol style="list-style-type: decimal">
<li>A randomly sampled subset of samples which take relatively short running time (e.g., 100-200 samples) can be firstly applied with cola, from which a specific combination of top-value method and partitioning method that gives the best results can be pre-selected. Later user can only apply these two specific methods to the complete dataset. This would be much faster than blindly running cola with many methods in sequence.</li>
<li>The random subset of samples can be treated as a training set to generate a classification of cells. Then, the class labels of the remaining samples can be predicted, e.g. by testing the distance to the centroid of each cell group, without rerunning consensus partitioning on them. cola implements a <code><a href="../reference/predict_classes-dispatch.html">predict_classes()</a></code> function for this purpose (see the vignette <a href="predict.html">“Predict classes for new samples”</a> for details).</li>
</ol>
<p>Note, since these two strategies are performed by sampling a small subset of cells from the cohort, the cell clusters with small size might not be detectable.</p>
<p>In the following examples, we use pseudo code to demonstrate the ideas. Assuming the full matrix is in an object <code>mat</code>. We randomly sample 200 samples from it:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">ind</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="../reference/ncol-dispatch.html">ncol</a></span>(<span class="no">mat</span>), <span class="fl">200</span>)
<span class="no">mat1</span> <span class="kw">=</span> <span class="no">mat</span>[, <span class="no">ind</span>]</pre></body></html></div>
<p><strong>Strategy 1</strong>. First we can apply cola on <code>mat1</code>:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">rl</span> <span class="kw">=</span> <span class="fu"><a href="../reference/run_all_consensus_partition_methods.html">run_all_consensus_partition_methods</a></span>(<span class="no">mat1</span>, <span class="no">...</span>)
<span class="fu"><a href="../reference/cola_report-dispatch.html">cola_report</a></span>(<span class="no">rl</span>, <span class="no">...</span>)</pre></body></html></div>
<p>Then find a best combination of top-value method and partitioining method. Assuming they are saved in objects <code>tm</code> and <code>pm</code>. Next run <code><a href="../reference/consensus_partition.html">consensus_partition()</a></code> on <code>mat</code> only with <code>tm</code> and <code>pm</code>:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">res</span> <span class="kw">=</span> <span class="fu"><a href="../reference/consensus_partition.html">consensus_partition</a></span>(<span class="no">mat</span>, <span class="kw">top_value_method</span> <span class="kw">=</span> <span class="no">tm</span>, <span class="kw">partition_method</span> <span class="kw">=</span> <span class="no">pm</span>, <span class="no">...</span>)</pre></body></html></div>
<p><strong>Strategy 2</strong>. Similar as Strategy 1, we get the <code>ConsensusPartition</code> object from methods <code>tm</code> and <code>pm</code>, which was applied on <code>mat1</code>:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">res</span> <span class="kw">=</span> <span class="no">rl</span>[<span class="no">tm</span>, <span class="no">pm</span>]</pre></body></html></div>
<p>Note the consensus partition object <code>res</code> is only based on a subset of original samples. With <code>res</code>, the classes of remaining samples can be predicted:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">mat2</span> <span class="kw">=</span> <span class="no">mat</span>[, <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="../reference/ncol-dispatch.html">ncol</a></span>(<span class="no">mat</span>)), <span class="no">ind</span>)]
<span class="no">mat2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">mat2</span>)))
<span class="no">cl</span> <span class="kw">=</span> <span class="fu"><a href="../reference/predict_classes-dispatch.html">predict_classes</a></span>(<span class="no">res</span>, <span class="no">mat2</span>)</pre></body></html></div>
<p>Please note, by default <code>mat1</code> is scaled in cola analysis, correspondingly, <code>mat2</code> should also be row-scaled.</p>
<p>You can also directly send <code>mat</code> to <code><a href="../reference/predict_classes-dispatch.html">predict_classes()</a></code> function:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">cl</span> <span class="kw">=</span> <span class="fu"><a href="../reference/predict_classes-dispatch.html">predict_classes</a></span>(<span class="no">res</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">mat</span>))))</pre></body></html></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
